CREATE DATABASE MOVIEDB;

USE MOVIEDB;

CREATE TABLE ACTOR (
Act_id int not null,
    Act_Name varchar(20) not null,
    Act_Gender char(1) not null,
    PRIMARY KEY (Act_id)
    );
   
 CREATE TABLE DIRECTOR (
Dir_id int not null,
    Dir_Name varchar(20) not null,
    Dir_Phone double not null,
    PRIMARY KEY(Dir_id)
    );
   
CREATE TABLE MOVIES (
Mov_id int not null,
    Mov_Title varchar(30) not null,
    Mov_Year int not null,
    Mov_Lang varchar(15) not null,
    Dir_id int not null,
    PRIMARY KEY(Mov_id),
    FOREIGN KEY(Dir_id) REFERENCES DIRECTOR(Dir_id) ON DELETE CASCADE
    );
    
CREATE TABLE MOVIE_CAST (
Act_id int not null,
    Mov_id int not null,
    Mrole varchar(20) not null,
    FOREIGN KEY(Act_id) REFERENCES ACTOR(Act_id) ON DELETE CASCADE,
FOREIGN KEY(Mov_id) REFERENCES MOVIES(Mov_id) ON DELETE CASCADE
    );
   
CREATE TABLE RATING (
Mov_id int not null,
    Rev_Stars float not null,
    FOREIGN KEY(Mov_id) REFERENCES MOVIES(Mov_id) ON DELETE CASCADE
    );
   
INSERT INTO ACTOR(Act_id, Act_Name, Act_Gender)VALUES(123,"Nivin","M");
INSERT INTO ACTOR(Act_id, Act_Name, Act_Gender)VALUES(124,"Arathy","F");
INSERT INTO ACTOR(Act_id, Act_Name, Act_Gender)VALUES(125,"Mega","F");
INSERT INTO ACTOR(Act_id, Act_Name, Act_Gender)VALUES(126,"Arun","M");
INSERT INTO ACTOR(Act_id, Act_Name, Act_Gender)VALUES(127,"Ragi","F");

INSERT INTO DIRECTOR (Dir_id,Dir_Name,Dir_Phone)VALUES(213,"Hitchcock",9897969594);
INSERT INTO DIRECTOR (Dir_id,Dir_Name,Dir_Phone)VALUES(214,"Steven Spielberg",9123435432);
INSERT INTO DIRECTOR (Dir_id,Dir_Name,Dir_Phone)VALUES(215,"Hanson",8987656754);
INSERT INTO DIRECTOR (Dir_id,Dir_Name,Dir_Phone)VALUES(216,"Coen",7656453212);
INSERT INTO DIRECTOR (Dir_id,Dir_Name,Dir_Phone)VALUES(217,"Raimi",9087654512);

INSERT INTO MOVIES (Mov_id,Mov_Title,Mov_Year,Mov_Lang,Dir_id)VALUES(312,"Fargo",2014,"English",213);
INSERT INTO MOVIES (Mov_id,Mov_Title,Mov_Year,Mov_Lang,Dir_id)VALUES(313,"Raising Arizona",1995,"Spanish",214);
INSERT INTO MOVIES (Mov_id,Mov_Title,Mov_Year,Mov_Lang,Dir_id)VALUES(314,"Wonder Boys",2017,"English",213);
INSERT INTO MOVIES (Mov_id,Mov_Title,Mov_Year,Mov_Lang,Dir_id)VALUES(315,"Master",2018,"English",214);
INSERT INTO MOVIES (Mov_id,Mov_Title,Mov_Year,Mov_Lang,Dir_id)VALUES(316,"Grand Master",1999,"English",215);

INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(123,312,"Ben");
INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(124,313,"Rony");
INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(124,314,"Alexa");
INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(126,315,"Nairobi");
INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(127,315,"Tokyo");
INSERT INTO MOVIE_CAST (Act_id,Mov_id,Mrole)VALUES(127,316,"Ann");

INSERT INTO RATING(Mov_id,Rev_Stars)VALUES(312,1.4);
INSERT INTO RATING(Mov_id,Rev_Stars)VALUES(313,3.5);
INSERT INTO RATING(Mov_id,Rev_Stars)VALUES(314,4.2);
INSERT INTO RATING(Mov_id,Rev_Stars)VALUES(315,6.5);
INSERT INTO RATING(Mov_id,Rev_Stars)VALUES(316,7.4);

SELECT * FROM ACTOR;
SELECT * FROM DIRECTOR;
SELECT * FROM MOVIES;
SELECT * FROM MOVIE_CAST;
SELECT * FROM RATING;


SELECT MOVIES.MOV_TITLE
FROM MOVIES
INNER JOIN DIRECTOR ON
MOVIES.DIR_ID=DIRECTOR.DIR_ID
WHERE DIR_NAME="HITCHCOCK";

SELECT MOV_TITLE,ACT_ID
FROM MOVIES M,MOVIE_CAST MC
WHERE M.MOV_ID=MC.MOV_ID AND ACT_ID IN (SELECT ACT_ID
FROM MOVIE_CAST GROUP BY ACT_ID
HAVING COUNT(ACT_ID)>1)
GROUP BY MOV_TITLE
HAVING COUNT(*)=1;


SELECT ACTOR.ACT_NAME,MOVIES.MOV_TITLE,MOVIES.MOV_YEAR
FROM ACTOR  
INNER JOIN MOVIE_CAST ON ACTOR.ACT_ID=MOVIE_CAST.ACT_ID
INNER JOIN MOVIES ON MOVIES.MOV_ID=MOVIE_CAST.MOV_ID
WHERE MOVIES.MOV_YEAR NOT BETWEEN 2000 AND 2015;
   
SELECT MOV_TITLE,MAX(REV_STARS)
FROM MOVIES
INNER JOIN RATING USING(MOV_ID)
GROUP BY MOV_TITLE
HAVING MAX(REV_STARS)>0
ORDER BY MOV_TITLE;

SET SQL_SAFE_UPDATES=0;
UPDATE RATING
SET REV_STARS=5.0
WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES
WHERE DIR_ID IN (SELECT DIR_ID FROM DIRECTOR
WHERE DIR_NAME="STEVEN SPIELBERG"));

SELECT * FROM RATING;
